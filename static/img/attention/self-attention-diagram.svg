<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650" font-family="Arial, sans-serif">
  <!-- Background -->
  <rect width="900" height="650" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#333">Self-Attention Mechanism</text>
  
  <!-- Input Embedding Box -->
  <rect x="380" y="60" width="140" height="50" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="450" y="90" text-anchor="middle" font-size="14" fill="#1565c0">v_bank</text>
  <text x="450" y="125" text-anchor="middle" font-size="11" fill="#666">(Input Embedding)</text>
  
  <!-- Arrows from input to Q, K, V -->
  <path d="M 420 110 L 200 170" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 450 110 L 450 170" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 480 110 L 700 170" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Weight Matrix Labels -->
  <text x="280" y="150" text-anchor="middle" font-size="12" fill="#d32f2f" font-style="italic">× W_Q</text>
  <text x="450" y="150" text-anchor="middle" font-size="12" fill="#388e3c" font-style="italic">× W_K</text>
  <text x="620" y="150" text-anchor="middle" font-size="12" fill="#7b1fa2" font-style="italic">× W_V</text>
  
  <!-- Q, K, V Boxes -->
  <rect x="130" y="175" width="140" height="50" rx="8" fill="#ffcdd2" stroke="#d32f2f" stroke-width="2"/>
  <text x="200" y="205" text-anchor="middle" font-size="14" fill="#c62828">Query (q)</text>
  
  <rect x="380" y="175" width="140" height="50" rx="8" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
  <text x="450" y="205" text-anchor="middle" font-size="14" fill="#2e7d32">Key (k)</text>
  
  <rect x="630" y="175" width="140" height="50" rx="8" fill="#e1bee7" stroke="#7b1fa2" stroke-width="2"/>
  <text x="700" y="205" text-anchor="middle" font-size="14" fill="#6a1b9a">Value (v)</text>
  
  <!-- Dot Product Section -->
  <path d="M 200 225 L 200 280 L 350 320" stroke="#d32f2f" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M 450 225 L 450 280 L 350 320" stroke="#388e3c" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Dot Product Box -->
  <rect x="280" y="310" width="140" height="50" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="350" y="340" text-anchor="middle" font-size="14" fill="#e65100">q · k</text>
  <text x="350" y="375" text-anchor="middle" font-size="11" fill="#666">(Attention Score)</text>
  
  <!-- Arrow to Softmax -->
  <path d="M 350 360 L 350 410" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Softmax Box -->
  <rect x="280" y="415" width="140" height="50" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
  <text x="350" y="445" text-anchor="middle" font-size="14" fill="#7b1fa2">Softmax</text>
  <text x="350" y="480" text-anchor="middle" font-size="11" fill="#666">(Normalize to sum=1)</text>
  
  <!-- Weight output -->
  <path d="M 350 465 L 350 510" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Weight Box -->
  <rect x="280" y="515" width="140" height="40" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="350" y="540" text-anchor="middle" font-size="14" fill="#2e7d32">w_i</text>
  
  <!-- Value path down -->
  <path d="M 700 225 L 700 530 L 500 560" stroke="#7b1fa2" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Multiplication symbol -->
  <path d="M 420 535 L 480 535" stroke="#666" stroke-width="2" fill="none"/>
  <text x="450" y="530" text-anchor="middle" font-size="18" fill="#333">×</text>
  
  <!-- Final weighted sum -->
  <rect x="380" y="565" width="140" height="50" rx="8" fill="#bbdefb" stroke="#1976d2" stroke-width="2"/>
  <text x="450" y="590" text-anchor="middle" font-size="13" fill="#1565c0">Σ w_i · v_i</text>
  <text x="450" y="630" text-anchor="middle" font-size="11" fill="#666">(Context-Aware Embedding)</text>
  
  <!-- Formula annotations on the right -->
  <rect x="750" y="280" width="130" height="140" rx="5" fill="#fff" stroke="#ddd" stroke-width="1"/>
  <text x="815" y="300" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">Formulas:</text>
  <text x="760" y="325" font-size="10" fill="#555">score = q · k</text>
  <text x="760" y="350" font-size="10" fill="#555">w = softmax(score)</text>
  <text x="760" y="375" font-size="10" fill="#555">output = Σ w_i · v_i</text>
  <text x="760" y="405" font-size="9" fill="#888">where q = W_Q · v</text>
  <text x="760" y="420" font-size="9" fill="#888">      k = W_K · v</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Legend -->
  <rect x="20" y="570" width="15" height="15" fill="#ffcdd2" stroke="#d32f2f"/>
  <text x="40" y="582" font-size="10" fill="#333">Query</text>
  <rect x="80" y="570" width="15" height="15" fill="#c8e6c9" stroke="#388e3c"/>
  <text x="100" y="582" font-size="10" fill="#333">Key</text>
  <rect x="140" y="570" width="15" height="15" fill="#e1bee7" stroke="#7b1fa2"/>
  <text x="160" y="582" font-size="10" fill="#333">Value</text>
</svg>